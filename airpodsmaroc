<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="site-title">Chargement...</title>
    <style id="dynamic-theme">
        :root { --primary: #000000; --bg: #ffffff; }
    </style>
    <style>
        /* Styles de base optimis√©s */
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; background: var(--bg); transition: 0.3s; }
        header { background: #fff; padding: 15px 5%; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 10px rgba(0,0,0,0.1); position: sticky; top: 0; z-index: 1000; }
        .logo { font-weight: 900; font-size: 1.6rem; color: var(--primary); text-transform: uppercase; }
        
        .container { max-width: 1200px; margin: 40px auto; padding: 0 20px; }
        .product-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 25px; }
        .card { background: white; padding: 20px; border-radius: 15px; text-align: center; box-shadow: 0 5px 15px rgba(0,0,0,0.05); border: 1px solid #eee; }
        .card img { width: 100%; height: 250px; object-fit: contain; border-radius: 10px; margin-bottom: 15px; }
        .price { font-size: 1.5rem; color: var(--primary); font-weight: bold; margin: 10px 0; }
        
        /* Boutons */
        .btn { border: none; padding: 12px 20px; border-radius: 8px; cursor: pointer; font-weight: bold; transition: 0.3s; }
        .btn-buy { background: var(--primary); color: white; width: 100%; }
        .btn-cart { background: #f0f0f0; color: #333; position: relative; }
        .cart-count { position: absolute; top: -5px; right: -5px; background: red; color: white; font-size: 12px; padding: 2px 6px; border-radius: 50%; }

        /* Panels */
        .panel { position: fixed; top: 0; width: 350px; height: 100%; background: white; z-index: 2000; transition: 0.4s; padding: 25px; box-shadow: 0 0 30px rgba(0,0,0,0.2); overflow-y: auto; box-sizing: border-box; }
        #admin-panel { left: -100%; background: #1a1a1a; color: white; }
        #admin-panel.open { left: 0; }
        #cart-panel { right: -100%; }
        #cart-panel.open { right: 0; }

        /* Admin Inputs */
        .admin-box { background: #2a2a2a; padding: 15px; border-radius: 10px; margin-bottom: 20px; border: 1px solid #444; }
        .admin-box input { width: 100%; padding: 10px; margin: 8px 0; border-radius: 5px; border: none; }
        label { font-size: 12px; color: #aaa; }
    </style>
</head>
<body>

<header>
    <div class="logo" id="brand-name">MON BRAND</div>
    <div style="display: flex; gap: 10px;">
        <button class="btn" onclick="togglePanel('admin-panel')">‚öôÔ∏è</button>
        <button class="btn btn-cart" onclick="togglePanel('cart-panel')">üõí <span class="cart-count" id="count">0</span></button>
    </div>
</header>

<div class="container">
    <div style="text-align: center; margin-bottom: 50px;">
        <h1 id="hero-title">Bienvenue</h1>
        <p id="hero-desc">Meilleurs produits, meilleurs prix.</p>
    </div>
    <div class="product-grid" id="grid"></div>
</div>

<div id="admin-panel" class="panel">
    <div id="login-form">
        <h2>Connexion Admin</h2>
        <input type="text" id="user-num" placeholder="Num√©ro (07...)">
        <input type="password" id="user-pass" placeholder="Mot de passe">
        <button class="btn" style="width: 100%; margin-top: 10px;" onclick="login()">Se connecter</button>
    </div>

    <div id="admin-content" style="display: none;">
        <h2>R√©glages Design</h2>
        <div class="admin-box">
            <label>Nom du Brand</label>
            <input type="text" id="edit-name" oninput="updateDesign()">
            <label>Couleur du th√®me</label>
            <input type="color" id="edit-color" oninput="updateDesign()" style="height: 40px;">
        </div>
        
        <h2>Mes Produits</h2>
        <button class="btn" style="width: 100%; background: var(--success); color: white;" onclick="addNew()">+ Ajouter un produit</button>
        <div id="admin-list" style="margin-top: 20px;"></div>
        <button class="btn" style="width: 100%; margin-top: 20px; background: #444; color: white;" onclick="location.reload()">D√©connexion</button>
    </div>
</div>

<div id="cart-panel" class="panel">
    <h2>Mon Panier</h2>
    <div id="cart-items"></div>
    <div id="cart-footer" style="display: none; margin-top: 20px;">
        <hr>
        <h3 style="display: flex; justify-content: space-between;">Total: <span id="total">0</span> DH</h3>
        <input type="text" id="c-name" placeholder="Nom Complet" style="width: 100%; padding: 12px; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 5px;">
        <input type="tel" id="c-phone" placeholder="Num√©ro de t√©l√©phone" style="width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #ddd; border-radius: 5px;">
        <button class="btn btn-buy" style="background: #25D366;" onclick="checkout()">COMMANDER VIA WHATSAPP</button>
    </div>
    <button class="btn" style="width: 100%; margin-top: 20px; background: none; color: #999;" onclick="togglePanel('cart-panel')">Fermer</button>
</div>

<script>
    // ACC√àS ET API
    const AUTH = { num: "0720508150", pass: "123456" };
    const FORMSPREE = "https://formspree.io/f/xzdgjowa";
    const WHATSAPP = "https://wa.me/message/EUZXVDRSY3QGM1";

    // DATA (Sauvegard√©e dans le navigateur)
    let shop = JSON.parse(localStorage.getItem('myShopData')) || {
        brand: "AIRPODS MAROC",
        color: "#000000",
        products: [{ id: 1, name: "AirPods Pro", price: 350, img: "aaa.jpg" }]
    };
    let cart = [];

    // --- FONCTIONS ---
    function login() {
        if(document.getElementById('user-num').value === AUTH.num && document.getElementById('user-pass').value === AUTH.pass) {
            document.getElementById('login-form').style.display = "none";
            document.getElementById('admin-content').style.display = "block";
            document.getElementById('edit-name').value = shop.brand;
            document.getElementById('edit-color').value = shop.color;
            renderAdmin();
        } else { alert("Acc√®s refus√© !"); }
    }

    function updateDesign() {
        shop.brand = document.getElementById('edit-name').value;
        shop.color = document.getElementById('edit-color').value;
        save();
        applyDesign();
    }

    function applyDesign() {
        document.getElementById('brand-name').innerText = shop.brand;
        document.getElementById('hero-title').innerText = shop.brand;
        document.title = shop.brand;
        document.getElementById('dynamic-theme').innerHTML = `:root { --primary: ${shop.color}; --bg: #f8fafc; }`;
    }

    function renderShop() {
        const grid = document.getElementById('grid');
        grid.innerHTML = shop.products.map(p => `
            <div class="card">
                <img src="${p.img}" onerror="this.src='https://via.placeholder.com/250?text=Pas+d+image'">
                <h3>${p.name}</h3>
                <div class="price">${p.price} DH</div>
                <button class="btn btn-buy" onclick="addToCart(${p.id})">AJOUTER AU PANIER</button>
            </div>
        `).join('');
    }

    function renderAdmin() {
        const list = document.getElementById('admin-list');
        list.innerHTML = shop.products.map((p, i) => `
            <div class="admin-box">
                <label>Nom</label><input type="text" value="${p.name}" oninput="editProd(${i},'name',this.value)">
                <label>Prix</label><input type="number" value="${p.price}" oninput="editProd(${i},'price',this.value)">
                <label>Image (ex: aaa.jpg)</label><input type="text" value="${p.img}" oninput="editProd(${i},'img',this.value)">
                <button onclick="deleteProd(${i})" style="color: #ff4444; background: none; border: none; cursor: pointer; font-size: 12px;">Supprimer le produit</button>
            </div>
        `).join('');
    }

    function editProd(i, f, v) { shop.products[i][f] = f==='price'?parseInt(v)||0:v; save(); renderShop(); }
    function deleteProd(i) { if(confirm("Supprimer ?")){shop.products.splice(i,1); save(); renderAdmin(); renderShop();}}
    function addNew() { shop.products.push({id:Date.now(), name:"Nouveau", price:0, img:"aaa.jpg"}); renderAdmin(); renderShop(); }
    
    function togglePanel(id) { document.getElementById(id).classList.toggle('open'); }
    function addToCart(id) {
        const p = shop.products.find(x => x.id === id);
        cart.push({...p, cId: Date.now()});
        updateCart();
        togglePanel('cart-panel');
    }
    function updateCart() {
        document.getElementById('count').innerText = cart.length;
        const list = document.getElementById('cart-items');
        if(cart.length === 0) { list.innerHTML = "<p>Votre panier est vide.</p>"; document.getElementById('cart-footer').style.display="none"; }
        else {
            list.innerHTML = cart.map((item, idx) => `<div style="display:flex; justify-content:space-between; margin-bottom:10px"><span>${item.name}</span><strong>${item.price} DH</strong></div>`).join('');
            document.getElementById('cart-footer').style.display="block";
            document.getElementById('total').innerText = cart.reduce((t, i) => t + i.price, 0);
        }
    }

    async function checkout() {
        const n = document.getElementById('c-name').value;
        const p = document.getElementById('c-phone').value;
        if(!n || !p) return alert("Remplissez vos infos !");
        const items = cart.map(i => i.name).join(', ');
        const total = document.getElementById('total').innerText;

        fetch(FORMSPREE, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ Nom: n, Tel: p, Articles: items, Total: total + " DH" })});
        window.open(`${WHATSAPP}?text=*NOUVELLE COMMANDE*%0Aüë§ Client: ${n}%0Aüìû Tel: ${p}%0Aüì¶ Produits: ${items}%0Aüí∞ Total: ${total} DH`);
    }

    function save() { localStorage.setItem('myShopData', JSON.stringify(shop)); }
    
    applyDesign();
    renderShop();
</script>

</body>
</html>
